#!/usr/bin/env ruby
$:.unshift(File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib')))
require 'boombera'

command, database, path, body = ARGV[0..3]

begin
  case command
  when 'install'
    Boombera.install_design_doc!(database)
    puts "The CouchDB Boombera application has been updated to version #{Boombera.version}"
  when 'put'
    db = Boombera.new(database)
    result = db.put(path, body)
    puts "Content Saved: #{path}"
  when 'get'
    db = Boombera.new(database)
    result = db.get(path)
    puts result.body
  end
rescue Boombera::VersionMismatch => e
  puts e.message
  puts "You may need to run 'boombera install #{database}' to update the"
  puts "CouchDB Boombera application."
  exit(1)
end
